# Development Guide

## Quick Start

### Local Development

1. **Setup environment:**
   ```bash
   make setup
   ```

2. **Run with hot reload:**
   ```bash
   make dev
   ```

3. **Or use the development script:**
   ```bash
   ./scripts/dev.sh
   ```

### Docker Development

1. **Run with Docker (auto-reload):**
   ```bash
   make docker-dev
   ```

2. **Or use the Docker script directly:**
   ```bash
   ./scripts/docker-dev.sh
   ```

## Available Commands

### Local Development
- `make setup` - Install dependencies and generate initial swagger docs
- `make dev` - Run with Air hot reload
- `make build` - Build the application
- `make run` - Run the built application
- `make swagger` - Generate swagger documentation
- `make clean` - Clean build artifacts

### Docker Commands
- `make docker-dev` - Run development environment with Docker
- `make docker-prod` - Run production environment with Docker
- `make docker-build` - Build Docker image
- `make docker-run` - Run Docker container
- `make docker-stop` - Stop all Docker containers
- `make docker-clean` - Clean Docker containers and images

## Swagger Documentation

Swagger documentation is automatically generated and updated:

- **Local development:** Automatically regenerated when you run `make dev` or `./scripts/dev.sh`
- **Docker development:** Automatically regenerated by Air when files change
- **Production build:** Generated during Docker build process

### Access Swagger UI
- **Local:** http://localhost:8081/swagger/index.html
- **Docker:** http://localhost:8081/swagger/index.html

## File Structure

```
├── cmd/user-service/main.go          # Application entry point
├── services/user/                    # User service
│   ├── handler.go                    # HTTP handlers
│   ├── service.go                    # Business logic
│   └── routes.go                     # Route definitions
├── internal/middleware/              # Middleware
│   ├── auth.go                       # Authentication middleware
│   ├── rate_limit.go                 # Rate limiting
│   └── logging.go                    # Logging middleware
├── pkg/models/                       # Data models
├── docs/                             # Generated swagger docs
├── deployments/                      # Deployment configurations
│   ├── docker/                       # Dockerfiles
│   └── docker-compose/               # Docker Compose files
└── scripts/                          # Development scripts
```

## Authentication System

The authentication system includes:

### Features
- JWT-based authentication
- Role-based access control (RBAC)
- Rate limiting for security
- Password hashing with bcrypt
- Token refresh mechanism
- Security logging

### Endpoints

#### Public Endpoints
- `POST /api/v1/users/register` - User registration
- `POST /api/v1/users/login` - User login

#### Protected Endpoints
- `POST /api/v1/users/refresh` - Refresh JWT token
- `GET /api/v1/users/me` - Get current user info
- `POST /api/v1/users/change-password` - Change password
- `GET /api/v1/users/{id}` - Get user by ID
- `PUT /api/v1/users/{id}` - Update user
- `DELETE /api/v1/users/{id}` - Delete user

#### Admin Endpoints
- `/api/v1/users/admin/*` - Admin-only endpoints (future)

### Security Features
- Rate limiting: 5 requests/minute for auth endpoints
- JWT token expiration: 24 hours
- Password requirements: minimum 6 characters
- Role-based middleware
- Security event logging

## Environment Variables

```bash
# Database
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=password
DB_NAME=video_streaming
DB_SSLMODE=disable

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379

# JWT
JWT_SECRET=your-secret-key
JWT_EXPIRES_IN=24
```

## Troubleshooting

### Swagger not updating
1. Make sure you're using the development commands (`make dev` or `make docker-dev`)
2. Check that Air is running and watching for changes
3. Manually regenerate: `make swagger`

### Docker issues
1. Ensure Docker is running
2. Clean Docker environment: `make docker-clean`
3. Rebuild: `make docker-dev`

### Database connection issues
1. Check if PostgreSQL is running
2. Verify environment variables
3. Check database logs in Docker: `docker compose logs postgres`
